[Unit]
Description=VR Hotspot Daemon
After=network.target
Wants=network.target

[Service]
Type=simple

# Live backend is a symlink maintained by the installer:
#   /var/lib/vr-hotspot/app/backend -> /var/lib/vr-hotspot/app/releases/<ver>/backend
WorkingDirectory=/var/lib/vr-hotspot/app/backend
Environment=PYTHONPATH=/var/lib/vr-hotspot/app/backend
Environment=PYTHONUNBUFFERED=1
Environment=PATH=/var/lib/vr-hotspot/app/backend/vendor/bin:/usr/sbin:/usr/bin:/sbin:/bin
Environment=LD_LIBRARY_PATH=/var/lib/vr-hotspot/app/backend/vendor/lib

# Bind host/port + optional token live here:
EnvironmentFile=-/etc/vr-hotspot/env

# Sanity check to avoid starting broken deployments
ExecStartPre=/usr/bin/python3 -m compileall -q /var/lib/vr-hotspot/app/backend/vr_hotspotd

ExecStart=/usr/bin/python3 -m vr_hotspotd.main
ExecStop=/bin/kill -TERM $MAINPID

Restart=on-failure
RestartSec=2

RuntimeDirectory=vr-hotspot
StateDirectory=vr-hotspot
LogsDirectory=vr-hotspot

StandardOutput=journal
StandardError=journal

# Conservative hardening
NoNewPrivileges=yes
PrivateTmp=yes
KillMode=mixed
TimeoutStopSec=12

[Install]
WantedBy=multi-user.target
